commands:
    01_export_beanstalk_env:
        command: "/tmp/export-eb-env.sh"

container_commands:
    # Set up Laravel key
    01_set_application_key:
        command: php artisan key:generate
        cwd: /var/app/current
    
    # Refresh cache
    02_refresh_cache:
        command: php artisan optimize
        cwd: /var/app/current
    # Migrate db
    03_migrate_db:
        command: php artisan migrate --force
        cwd: /var/app/current

files:
    "/tmp/export-eb-env.sh":
        content: |
         #!/bin/bash

        export RDS_HOSTNAME=$(/opt/elasticbeanstalk/bin/get-config environment -k RDS_HOSTNAME)
        export RDS_DB_NAME=$(/opt/elasticbeanstalk/bin/get-config environment -k RDS_DB_NAME)
        export RDS_USERNAME=$(/opt/elasticbeanstalk/bin/get-config environment -k RDS_USERNAME)
        export RDS_PASSWORD=$(/opt/elasticbeanstalk/bin/get-config environment -k RDS_PASSWORD)
        export RDS_PORT=$(/opt/elasticbeanstalk/bin/get-config environment -k RDS_PORT)